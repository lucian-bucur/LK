---
- hosts: webservers
  become: True
  become_method:  sudo
  become_user:    root
  gather_facts:   true
  vars:
       dict: {}
  vars_files:
       group_vars/vars.yml
  tasks:
  # --------------------------------------------------------------------------
  # BASICS PACKAGES
  - name: modules python installation
    raw: "sudo apt-get -y install {{ item }}"
    with_items: ["python", "python-pip"]

  - name: upgrade pip
    pip: name=pip state=latest
  # --------------------------------------------------------------------------
  # USERNAMES & GROUPS
  - name: users configuration
    import_tasks: tasks/users_configuration.yml
    ignore_unreachable: true
  # --------------------------------------------------------------------------
  # BASIC TESTS
  - debug: var=ansible_all_ipv4_addresses
  - name: change_reports task
    change_reports:
       domains:    "{{ domains }}"
       interfaces: "{{ ansible_all_ipv4_addresses }}"

    register:  reports
  - debug: var=reports

  - name: export 1
    set_fact:
        dict: "{{ dict | combine(reports.value) }}"

  - name: change_reports task
    change_reports:
       domains:    "{{ domains }}"
       interfaces: "{{ ansible_all_ipv6_addresses }}"
    register:   reports
  - debug:  var=reports

  - name: export 2
    set_fact:
        dict: "{{ dict | combine(reports.value) }}"

  - debug:  var=dict
